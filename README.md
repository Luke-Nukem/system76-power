# system76-power

A power management daemon and utility, from System76. On Pop!_OS, it is accompanied with the [gnome shell extension](https://github.com/pop-os/gnome-shell-extension-system76-power) to control the daemon from the shell.

## Features

- A power daemon with a DBUS API.
- Configurable power profiles.
  - Includes the following default profiles: battery, balanced, performance.
  - Other profiles may be defined in the configuration file at `/etc/system76-power/config.toml`.
- Configurable fan curve profiles.
- Ability to query for switchable graphics, and the active graphics
- Switching between Intel and NVIDIA graphics
- Scripts may be executed on power profile changes.
  - Scripts are stored at `/etc/system76-power/scripts/${PROFILE_NAME}`


## Configuration

The daemon's configuration file is automatically generated the first time it is run. It will look like this:

```toml
# This config is automatically generated by system76-power.

# Uncomment to enable extra untested power-saving features
# experimental = true

# Configurations for available fan curve profiles.
#
# A curve is defined as a collection of points, each point containing a:
#   - `temp`: System temperature, in hundredths of a degree.
#   - `duty`: Fan speed, in hundredths of a percent.
# [fan_curves]
# The default fan curve.
# standard = [ { temp = 2000, duty = 3000 },
#              { temp = 3000, duty = 3500 },
#              { temp = 4000, duty = 4250 },
#              { temp = 5000, duty = 5250 },
#              { temp = 6500, duty = 10000 } ]

# [profiles.battery]
# Set the backlight brightness for each keyboard.
# backlight_keyboard = 0

# Set the backlight brightness for each screen.
# backlight_screen = 10

# Enables laptop mode in the kernel if greater than 0.
# Laptop mode schedules and batches disk I/O requests to keep
# the system in a low power state for greater periods of time.
# laptop_mode = 2

# Configures the kernel to keep up to N seconds of state stored in memory
# before writing it to the disk. This means that sudden power loss could lose
# up to N seconds of work, but power is saved by batching writes together.
# max_lost_work = 15

# Configure runtime power management for PCI devices.
# pci_runtime_pm = true

# The minimum clock speed of an Intel CPU, as a percent.
# pstate_min = 0

# The maximum clock speed of an Intel CPU, as a percent.
# pstate_max = 50

# Whether an Intel CPU should have turbo enabled or disabled.
# pstate_turbo = false

# Set a power profile for graphics cards.
# graphics = 'low'

# [profiles.balanced]
# backlight_keyboard = 50
# backlight_screen = 40
# laptop_mode = 0
# max_lost_work = 15
# pci_runtime_pm = true
# pstate_min = 0
# pstate_max = 100
# pstate_turbo = true
# graphics = 'balanced'

# [profiles.performance]
# backlight_keyboard = 100
# backlight_screen = 100
# laptop_mode = 0
# max_lost_work = 15
# pci_runtime_pm = false
# pstate_min = 50
# pstate_max = 100
# pstate_turbo = true
# graphics = 'performance'

```

Note that the `experimental` option will enable some additional power-saving features, as seen from Powertop's autotune & TLP.
